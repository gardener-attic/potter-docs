<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">

  <head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Project Potter Website"><meta name="copyright" content="Copyright 2021 Potter project authors.">
  
  <title>GitOps :: Potter</title>
  <link rel="icon" type="image/x-icon" href='https://gardener.github.io/potter-docs/images/favicon.ico'>
  <link rel="icon" type="image/png"    href='https://gardener.github.io/potter-docs/images/favicon-32x32.png' sizes="32x32">
  <link rel="icon" type="image/png"    href='https://gardener.github.io/potter-docs/images/favicon-16x16.png' sizes="16x16">
  
  
    
  

  
  <link href="/potter-docs/css/nucleus.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/font-awesome.min.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/hybrid.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/featherlight.min.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/perfect-scrollbar.min.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/auto-complete.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/skeleton.css?1672844425" rel="stylesheet">
  <link href="/potter-docs/css/sheetslider.css?1672844425" rel="stylesheet">

  
  
  
  
  <link rel="stylesheet" href="/potter-docs/css/gardener.7593938070d708e7b1bec0e9172492ff8f780d7c20e680f994075d57795a3335.css">
  
  <script src="/potter-docs/js/moment.js?1672844425"></script>
  <script src="/potter-docs/js/vivus.js?1672844425"></script>
  <script src="/potter-docs/js/scrollreveal.js?1672844425"></script>
  <script src="/potter-docs/js/inlineSVG.js?1672844425"></script>
  <script src="/potter-docs/js/jquery.min.js?1672844425"></script>
  <script src="/potter-docs/js/fixed.js?1672844425"></script>
  <script src="/potter-docs/js/clipboard.min.js?1672844425"></script>

  <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
  

</head>


  <body data-url="/potter-docs/controller-docs-0.149.0/docs/special-topics/gitops/" class="has-sticky-navigation">
      
    <script>
  $(document).ready(function () {
    function initStickyNav() {
      var stickyPoint;
      var tln = document.querySelector(".tln");
      if (!tln) {
        return;
      }
      var stickyPointEl = document.querySelector(".sticky-nav-point");
      if (stickyPointEl == null) {
        stickyPointEl = document.querySelector("body");
        stickyPoint = 0;
      } else {
        stickyPoint = stickyPointEl.clientHeight + stickyPointEl.offsetTop;
      }
      var bodySelector = document.getElementsByTagName("body")[0];
      var tlnHeight = tln.clientHeight;
      var stickyNavigation = function () {
        if (window.pageYOffset + tlnHeight >= stickyPoint) {
          bodySelector.classList.add("has-sticky-navigation");
          tln.classList.add("sticky-top");
        } else {
          bodySelector.classList.remove("has-sticky-navigation");
          tln.classList.remove("sticky-top");
        }
      }

      window.onscroll = function () {
        stickyNavigation();
      };
    }
    initStickyNav();

    function closeAllSelect() {
      document.getElementById("docOptions").classList.remove("show");
    }

    function show(e) {
      e.stopPropagation();
      document.getElementById("docOptions").classList.add("show");
    }

    document.addEventListener("click", closeAllSelect);
    document.getElementById("docSelector").addEventListener("click", show);
  });

</script>

<div class="tln fixedsticky sticky-top"><header class="navigation">
    <div class="container">
      <div class="navigation-wrapper">
        <a href="/potter-docs/" class="logo">
          <img src="/potter-docs/images/logo.png" />
          <span class="title">Potter</span>
        </a>
        <a class="nav-button navbar-toggler" href="#"><i class="fa fa-bars"></i></a>
        
        <div class="navbar-collapse">
          <ul class="links">
            
            
            
            
            
            <li class="link has-child">
              <a href="/potter-docs/hub-docs/home">Hub Docs</a>
            </li>
            
            
            
            <li class="link has-child active">









<a id="docSelector">Controller Docs 0.149.0</a>
<div id="docOptions" class="doc-options">
    <ul><li>
            
            
            
            
            
            
            
            <a href="https://gardener.github.io/potter-docs///controller-docs/home">Controller Docs
                0.150.0
            </a>
            
        </li><li>
            
            
            
            
            
            
            
            <a href="https://gardener.github.io/potter-docs///controller-docs-0.149.0/home" class="activeVersion">Controller Docs
                0.149.0
            </a>
            
        </li><li>
            
            
            
            
            
            
            
            <a href="https://gardener.github.io/potter-docs///controller-docs-0.148.0/home">Controller Docs
                0.148.0
            </a>
            
        </li></ul>
</div>
              
            </li>
            
            <li class="link ">
              <a href="/potter-docs/contribute/">Contribute</a>
            </li></ul>
        </div>
      </div>
    </div>
  </header>
</div>
<script>
  
  $(".navigation .navbar-toggler").click(function (evt) {
    $(".navigation .navbar-collapse").toggle();
    $(".navigation").toggleClass("collapsed");
    $(".navigation .search-box").toggle();
  })
</script>





<style>
  #docSelector {
    cursor: pointer;
  }

  .doc-options {
    position: fixed;
    background-color: #0b8062;
    text-align: left;
    display: none;
  }

  .doc-options ul li {
    margin-bottom: 0;
  }

  .doc-options ul li a:hover {
    background-color: #0c694f;
  }

  .doc-options ul {
    list-style: none;
    padding: 0px;
    margin: 0px;
    text-align: left;
  }

  .doc-options ul li a {
    padding: 10px;
    margin: 0;
  }

  .doc-options .activeVersion {
    background-color: #ec682a;
  }

  .show {
    display: block;
  }
</style>
    
    
  
<div class="sln">
    <div class="overlay-band">
        <ul class="nav-list container">
            
            
            <li title="Home"><a class="navbar-link" href="/potter-docs/controller-docs-0.149.0/home/">Home</a>
            </li>
            
            
            
            
            
            
            <li title="Docs"><a class="navbar-link is-active" href="/potter-docs/controller-docs-0.149.0/docs/">Docs</a>
            </li>
            
            
            
            
        </ul>
    </div>
</div>

    
    <div class="main container">
      
  <nav id="sidebar" class="collapsed container menu">

    <div class="highlightable">
        <ul class="topics"><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/" title="Docs" class="dd-item parent root  collapsible" data-depth="0">
        <a href="/potter-docs/controller-docs-0.149.0/docs/"><span class="menu-item-text">Docs</span>
        </a><ul><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/helm-example/" title="Cluster-BoM Example with Helm Applications" class="dd-item top-level" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/helm-example/"><span class="toggle"></span><span class="menu-item-text">Cluster-BoM Example with Helm Applications</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/kapp-example/" title="Cluster-BoM Example with kapp Applications" class="dd-item top-level" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/kapp-example/"><span class="toggle"></span><span class="menu-item-text">Cluster-BoM Example with kapp Applications</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/plain-yaml-example/" title="Cluster-BoM Example with plain yaml K8s resources" class="dd-item top-level" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/plain-yaml-example/"><span class="toggle"></span><span class="menu-item-text">Cluster-BoM Example with plain yaml K8s resources</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/status/" title="Cluster-BoM Status Section explained" class="dd-item top-level" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/status/"><span class="toggle"></span><span class="menu-item-text">Cluster-BoM Status Section explained</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/template/" title="Cluster-BoM Template" class="dd-item top-level" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/template/"><span class="toggle"></span><span class="menu-item-text">Cluster-BoM Template</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/" title="Special Topics" class="dd-item parent top-level collapsible" data-depth="1">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/">
            <span class="toggle fa fa-angle-down"></span><span class="menu-item-text">Special Topics</span>
        </a><ul><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/disable-a-clusterbom/" title="Disable a ClusterBom" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/disable-a-clusterbom/"><span class="toggle"></span><span class="menu-item-text">Disable a ClusterBom</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/fetching-resources-from-private-github-repo/" title="Fetching Resources From a private GitHub Repository" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/fetching-resources-from-private-github-repo/"><span class="toggle"></span><span class="menu-item-text">Fetching Resources From a private GitHub Repository</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/gitops/" title="GitOps" class="dd-item parent active" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/gitops/"><span class="toggle"></span><span class="menu-item-text">GitOps</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/manual-reconcile/" title="Manual Reconcile" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/manual-reconcile/"><span class="toggle"></span><span class="menu-item-text">Manual Reconcile</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/named-secrets/" title="Named Secrets" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/named-secrets/"><span class="toggle"></span><span class="menu-item-text">Named Secrets</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/resource-ready-requirements/" title="Ready Requirements" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/resource-ready-requirements/"><span class="toggle"></span><span class="menu-item-text">Ready Requirements</span>
        </a></li><li data-nav-id="/potter-docs/controller-docs-0.149.0/docs/special-topics/secret-handling/" title="Secret Handling" class="dd-item" data-depth="2">
        <a href="/potter-docs/controller-docs-0.149.0/docs/special-topics/secret-handling/"><span class="toggle"></span><span class="menu-item-text">Secret Handling</span>
        </a></li></ul></li></ul></li></ul>
    </div>
</nav>
<a href="#" class="menu-toggler"><i class="fa fa-angle-double-left"></i></a>

<script>
    $(document).ready(function(){
        $("#sidebar .dd-item:not(.top-level):not(.parent)").hide();
        $("#sidebar .dd-item.parent").siblings(".dd-item").show();
        $('.dd-item', "#sidebar .dd-item.parent").show();

        
        $(".menu-toggler").click(function(evt){
            $("#sidebar").toggleClass("collapsed");
            $(".menu-toggler span").toggleClass("fa-angle-double-left");
            $(".menu-toggler span").toggleClass("fa-angle-double-right");
        });
    })
</script>

      <section>
        
        <div class="highlightable body-inner-wrapper">
          
          
          <div id="body-inner" class="">
            
<div class="docs page"><h1>GitOps</h1>
  <div class="properties">
      
  </div>
  
    

	<p>In this chapter we show simple GitOps scenarios generating and updating Cluster-BoMs stored in a GitHub repository including templating.</p>
<h2 id="simple-example-without-templating">Simple Example Without Templating</h2>
<p>Assume we want to deploy an Application-Cluster-BoM like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">hub.k8s.sap.com/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterBom</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">simple-grafana</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">applicationConfigs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">configType</span><span class="p">:</span><span class="w"> </span><span class="l">helm</span><span class="w">
</span><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">    </span><span class="nt">typeSpecificData</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">catalogAccess</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">chartName</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">        </span><span class="nt">chartVersion</span><span class="p">:</span><span class="w"> </span><span class="m">5.0.0</span><span class="w">
</span><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">      </span><span class="nt">installName</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">my-target-cluster-namespace</span><span class="w">
</span><span class="w">  </span><span class="nt">secretRef</span><span class="p">:</span><span class="w"> </span><span class="l">my-cluster.kubeconfig</span><span class="w">
</span></code></pre></div><p>Assume this Application-Cluster-BoM exists in a GitHub repository. We want that changes of this Application-Cluster-BoM in the git repository are applied automatically, i.e. without executing a command manually. We also want that this is done soon after the change in the git repository, let&rsquo;s say in about a minute afterwards. To achieve this, we do not create the Application-Cluster-BoM manually, but install it in our Gardener project via a second Cluster-BoM, called GitOps-Cluster-BoM. It looks as follows.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">hub.k8s.sap.com/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterBom</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">gitops-simple</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo              </span><span class="w"> </span><span class="c"># Same namespace as for the Application-Cluster-BoM</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">applicationConfigs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">configType</span><span class="p">:</span><span class="w"> </span><span class="l">kapp</span><span class="w">
</span><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">gitops</span><span class="w">
</span><span class="w">    </span><span class="nt">typeSpecificData</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">syncPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">1m                        </span><span class="w"> </span><span class="c"># Intervall for checking changes of the Application-Cluster-BoM</span><span class="w">
</span><span class="w">      </span><span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo        </span><span class="w"> </span><span class="c"># Must be the same namespace as in metadata.namespace</span><span class="w">
</span><span class="w">      </span><span class="nt">fetch</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">git</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">ref</span><span class="p">:</span><span class="w"> </span><span class="l">origin/master</span><span class="w">
</span><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;GITREPO-URL&gt;                </span><span class="w"> </span><span class="c"># Git repository containing the Application-Cluster-BoM</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">gitops/simple/application</span><span class="w"> </span><span class="c"># Folder containing the Application-Cluster-BoM</span><span class="w">
</span><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">ytt</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">      </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">kapp</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">  </span><span class="nt">secretRef</span><span class="p">:</span><span class="w"> </span><span class="l">my-robot-secret                </span><span class="w"> </span><span class="c"># Secret to create the Application-Cluster-BoM </span><span class="w">
</span><span class="w">                                             </span><span class="c"># in Gardener namespace garden-apphubdemo.</span><span class="w">
</span><span class="w">                                             </span><span class="c"># See section &#34;Secret to Create Application-Cluster-BoM&#34; below</span><span class="w">
</span><span class="w">                                             </span><span class="c"># how to create this secret.</span><span class="w">
</span></code></pre></div><p>When you have deployed the GitOps-Cluster-BoM, the AppHub watches the specified folder in the git repositoy. It will fetch the Application-Cluster-BoM from there and deploy it in the Gardener namespace of the GitOps-Cluster-BoM. As soon as the Application-Cluster-BoM has been deployed, the specified application (in this example grafana) will be deployed on the target cluster. The sync period (<code>spec.applicationConfigs.typeSpecificData.syncPeriod</code>) defines how often the Application-Cluster-BoM is checked for changes in the git repository. For example, if you change the Application-Cluster-BoM by increasing the grafana chartVersion, then the AppHub recognizes this change within the sync period and will deploy the new version automatically.</p>
<p>You could store additional Application-Cluster-BoMs in the same folder as the first, and they will also be deployed by the same GitOps-Cluster-BoM.</p>
<p>Please note that in order to make this work, you need to create a secret in your Garden Project first, which is needed to create the Application-Cluster-BoM in the Garden Project. See <a href="#secret-to-create-an-application-cluster-bom">this section</a> for more information.</p>
<p>To access private repositories, see <a href="../fetching-resources-from-private-github-repo/">Fetching-Resources-From-a-Private-GitHub-Repository</a></p>
<h2 id="example-with-templating-and-multiple-clusters">Example With Templating and Multiple Clusters</h2>
<p>In this example, we want to deploy the same application with different settings on a dev and a live cluster. For example, we want to deploy grafana in version 5.0.0 on a live cluster and in version 5.0.2 on a dev cluster. We use the following template <code>application_clusterbom.yml</code> for the Application-Cluster-BoM. The templating tool is ytt.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c">#@ load(&#34;@ytt:data&#34;, &#34;data&#34;)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">hub.k8s.sap.com/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterBom</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="c">#@ data.values.clusterbom_name</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">applicationConfigs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">configType</span><span class="p">:</span><span class="w"> </span><span class="l">helm</span><span class="w">
</span><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">    </span><span class="nt">typeSpecificData</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">catalogAccess</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">chartName</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">        </span><span class="nt">chartVersion</span><span class="p">:</span><span class="w"> </span><span class="c">#@ data.values.chart_version</span><span class="w">
</span><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">      </span><span class="nt">installName</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span><span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">my-target-cluster-namespace</span><span class="w">
</span><span class="w">  </span><span class="nt">secretRef</span><span class="p">:</span><span class="w"> </span><span class="c">#@ data.values.secret_ref</span><span class="w">
</span></code></pre></div><p>For the dev cluster we fill the template with values from the following values <code>values_dev.yml</code>file:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c">#@data/values</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">clusterbom_name</span><span class="p">:</span><span class="w"> </span><span class="l">multi-grafana-dev</span><span class="w">
</span><span class="w"></span><span class="nt">chart_version</span><span class="p">:</span><span class="w"> </span><span class="m">5.0.2</span><span class="w">
</span><span class="w"></span><span class="nt">secret_ref</span><span class="p">:</span><span class="w"> </span><span class="l">dev.kubeconfig</span><span class="w">
</span></code></pre></div><p>For the live cluster we fill the template with values from the following values <code>values_live.yml</code>file:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c">#@data/values</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">clusterbom_name</span><span class="p">:</span><span class="w"> </span><span class="l">multi-grafana-live</span><span class="w">
</span><span class="w"></span><span class="nt">chart_version</span><span class="p">:</span><span class="w"> </span><span class="m">5.0.0</span><span class="w">
</span><span class="w"></span><span class="nt">secret_ref</span><span class="p">:</span><span class="w"> </span><span class="l">live.kubeconfig</span><span class="w">
</span></code></pre></div><p>The template and the values files are stored in a git repository with the following directory structure:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">gitops
└── multi
    ├── base
    │   └── application_clusterbom.yml
    ├── dev
    │   └── values_dev.yml
    └── live
        └── values_live.yml
</code></pre></div><p>To deploy the Application-Cluster-Bom for the dev landscape, we use the following GitOps-Cluster-BoM, which combines the Cluster-Bom template with the dev values.</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">hub.k8s.sap.com/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterBom</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">gitops-multi</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">applicationConfigs</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">configType</span><span class="p">:</span><span class="w"> </span><span class="l">kapp</span><span class="w">
</span><span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">gitops</span><span class="w">
</span><span class="w">    </span><span class="nt">typeSpecificData</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">syncPeriod</span><span class="p">:</span><span class="w"> </span><span class="l">1m</span><span class="w">
</span><span class="w">      </span><span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">garden-apphubdemo</span><span class="w">
</span><span class="w">      </span><span class="nt">fetch</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">git</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">ref</span><span class="p">:</span><span class="w"> </span><span class="l">origin/master</span><span class="w">
</span><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;GITREPO-URL&gt;</span><span class="w">
</span><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">gitops/multi</span><span class="w">
</span><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">ytt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="l">base </span><span class="w"> </span><span class="c"># Folder gitops/multi/base in the git repo contains the file application_clusterbom.yml</span><span class="w">
</span><span class="w">          </span>- <span class="l">dev  </span><span class="w"> </span><span class="c"># Folder gitops/multi/dev  in the git repo contains the file values_dev.yml</span><span class="w">
</span><span class="w">      </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">kapp</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">  </span><span class="nt">secretRef</span><span class="p">:</span><span class="w"> </span><span class="l">my-robot-secret</span><span class="w">
</span></code></pre></div><p>For the live landscape, use a second GitOps-Cluster-Bom which combines the Cluster-Bom template with the live values:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">ytt</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">          </span>- <span class="l">base </span><span class="w"> </span><span class="c"># Contains the Cluster-BoM template</span><span class="w">
</span><span class="w">          </span>- <span class="l">live </span><span class="w"> </span><span class="c"># Contains the live values</span><span class="w">
</span></code></pre></div><p>There are many more possibilities to template with ytt. For more details and further references, see <a href="../../kapp-example/">Cluster-BoM-kapp-Example</a>.</p>
<h2 id="secret-to-create-an-application-cluster-bom">Secret to Create an Application-Cluster-BoM</h2>
<p>The Application-Cluster-BoMs are created on the Gardener cluster. Therefore we need a secret with these privileges. To create this secret proceed as follows.</p>
<ol>
<li>Create a service account for your Gardener project in the <em>Members</em> section of the Gardener Dashboard:</li>
<li>Download the kubeconfig for this service account.</li>
<li>Create a new secret using the service account kubeconfig file. Use the same service account kubeconfig as context, so that the secret will be created in the Gardener project.</li>
</ol>
<p>Example:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">kubectl create secret generic &lt;SECRET-NAME&gt; -n garden-&lt;GARDEN-PROJECT-NAME&gt; --from-file<span class="o">=</span><span class="nv">kubeconfig</span><span class="o">=</span>&lt;PATH-TO-SERVICE-ACCOUNT-KUBECONFIG&gt;
</code></pre></div>
	
</div>
            
          </div>
        </div>
        
  
              <div class="howto_tickets">
                
                
                
                
                <a href="https://github.com/gardener/potter-hub/issues/new/choose" target="_blank">
                    <span>Let us know how can we improve.</span>
                    <span>Open <img src="https://gardener.github.io/potter-docs/images/branding/github-mark-logo-green.svg"/> GitHub Issue <i class="fa fa-external-link" aria-hidden="true"></i></span>
                </a>
            </div>
  

      </section>
      
    </div><style>
 
</style>
<footer class="footer">
  <div class="container footer-wrapper">
    <img src="/potter-docs/images/lp/logo.png" alt="Logo Gardener" class="logo"/>
    <ul class="media-wr">       
      <li>
        <a target="_blank" href="https://github.com/gardener/potter-hub">
          <img src="/potter-docs/images/branding/github-mark-logo.png" class="media-icon" />
          <div class="media-text">GitHub</div>
        </a>
      </li>                   
    </ul>
    <span class="copyright">Copyright 2021 Potter project authors. Privacy Statement</span>
  </div>
</footer>
    
    <script src="/potter-docs/js/perfect-scrollbar.min.js?1672844425"></script>
    <script src="/potter-docs/js/perfect-scrollbar.jquery.min.js?1672844425"></script>
    <script src="/potter-docs/js/jquery.sticky.js?1672844425"></script>
    <script src="/potter-docs/js/featherlight.min.js?1672844425"></script>
    <script src="/potter-docs/js/html5shiv-printshiv.min.js?1672844425"></script>
    <script src="/potter-docs/js/modernizr.custom.71422.js?1672844425"></script>

    <link href="/potter-docs/mermaid/mermaid.css?1672844425" type="text/css" rel="stylesheet" />
    <script src="/potter-docs/mermaid/mermaid.js?1672844425"></script>
    <script src="/potter-docs/js/code-snippets.js?1672844425"></script>
    <script>
      mermaid.initialize({ startOnLoad: true, htmlLables: true });
      function createIssue(issueUrl, page, url) {
          var uri = issueUrl+"?title=Documentation issue on page \""+page+"\"";
          uri = uri+ "&body=\n\n<- DESCRIBE MISSING OR FAULTY DOCUMENTATION HERE->\n\n---\nPage: ["+ page +"]("+
          url+ ")\ndon't remove the link to the page. It's required for the processor"
          var res = encodeURI(uri);
          res +="&labels=area/documentation"
          window.open(res,"issue")
          return false;
      }

      $(document).ready(function() {


        inlineSVG.init();

        $("[data-publishdate]").each(function(){
          $(this).text(moment($(this, "YYYY-MM-DD", "YYYY-MM-DD hh:mm:ss").attr("data-publishdate")).fromNow());
        });
          
        new ClipboardJS('.clipboard-copy');

        $("body").codeSnippets();
      });
    </script>

    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id="
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    
  </body>
</html>